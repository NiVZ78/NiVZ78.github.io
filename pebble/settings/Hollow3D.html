<!DOCTYPE html>
<html manifest="manifest.appcache">
<head>
	<title>Hollow3D Settings</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/bootstrap-theme.min.css" rel="stylesheet">

	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
</head>
<body>
    <div class="container">

	<h2>Hollow3D Settings</h2>
      
      	<form id="configure-form" class="form-configure well" action="#" method="POST">
        <h4>Hollow3D Font</h4>
        <p><small>Choose 'Yes' to use the Hollow3D font or 'No' to use solid font.</small></p>
        <div class="btn-group" data-toggle="buttons">
          <label class="btn btn-primary">
            <input type="radio" name="hollowfont" id="hollowfont1" value="1"> Yes
          </label>
          <label class="btn btn-primary">
            <input type="radio" name="hollowfont" id="hollowfont2" value="0"> No
          </label>
        </div>
        <hr />
        <h4>Invert Colours</h4>
        <p><small>Choose 'Yes' for White or 'No' for Black.</small></p>
        <div class="btn-group" data-toggle="buttons">
          <label class="btn btn-primary">
            <input type="radio" name="invert" id="invert1" value="1"> Yes
          </label>
          <label class="btn btn-primary">
            <input type="radio" name="invert" id="invert2" value="0"> No
          </label>
        </div>
        <hr />
        <h4>UK Date Format</h4>
        <p><small>Choose 'Yes' to use DD-MM or 'No' to use MM-DD.</small></p>
        <div class="btn-group" data-toggle="buttons">
          <label class="btn btn-primary">
            <input type="radio" name="ukdate" id="ukdate1" value="1"> Yes
          </label>
          <label class="btn btn-primary">
            <input type="radio" name="ukdate" id="ukdate2" value="0"> No
          </label>
        </div>
        <hr />
        <h4>Hide Branding</h4>
        <p><small>Choose 'Yes' to hide the Pebble logo or 'No' to show it.</small></p>
        <div class="btn-group" data-toggle="buttons">
          <label class="btn btn-primary">
            <input type="radio" name="branding" id="branding1" value="1"> Yes
          </label>
          <label class="btn btn-primary">
            <input type="radio" name="branding" id="branding2" value="0"> No
          </label>
        </div>
        <hr />
        <div class="clearfix">
          <input class="btn btn-lg btn-primary btn-block" id="save" type="submit" value="Save"/>
        </div>
      </form>
	  </div>

    <div class="footer container">
    	<p>Hollow3D by <a href="http://twitter.com/NiVZ">NiVZ</a></p>
    </div>
    
    <script>
          
      // Something like this to get query variables.
      function getQueryParam(variable, default_) {
          var query = location.search.substring(1);
          var vars = query.split('&');
          for (var i = 0; i < vars.length; i++) {
              var pair = vars[i].split('=');
              if (pair[0] == variable)
                  return decodeURIComponent(pair[1]);
          }
          return default_ || false;
      }    

      var mHollowfont;
      var mInvert;
      var mUkdate;
      var mBranding;
      
      $().ready(function () {


	mHollowfont = parseInt(localStorage.getItem("hollowfont"));
        mInvert = parseInt(localStorage.getItem("invert"));
        mUkdate = parseInt(localStorage.getItem("ukdate"));
        mBranding = parseInt(localStorage.getItem("branding"));
		

	if(isNaN(mHollowfont)) {
          mHollowfont = 1;
        }
        if(isNaN(mInvert)) {
          mInvert = 0;
        }
	if(isNaN(mUkdate)) {
          mUkdate = 0;
        }
        if(isNaN(mBranding)) {
          mBranding = 0;
        }          
        
        
        if(mHollowfont) {
          $('#hollowfont1').prop('checked', true);
          $('#hollowfont1').parent().addClass('active');
          
          $('#hollowfont2').prop('checked', false);
          $('#hollowfont2').parent().removeClass('active');
        } 
        else {
          $('#hollowfont1').prop('checked', false);
          $('#hollowfont1').parent().removeClass('active');
          
          $('#hollowfont2').prop('checked', true);
          $('#hollowfont2').parent().addClass('active'); 
        }


        if(mInvert) {
          $('#invert1').prop('checked', true);
          $('#invert1').parent().addClass('active');
          
          $('#invert2').prop('checked', false);
          $('#invert2').parent().removeClass('active');
        } 
        else {
          $('#invert1').prop('checked', false);
          $('#invert1').parent().removeClass('active');
          
          $('#invert2').prop('checked', true);
          $('#invert2').parent().addClass('active'); 
        }
        		
        if(mUkdate) {
          $('#ukdate1').prop('checked', true);
          $('#ukdate1').parent().addClass('active');
          
          $('#ukdate2').prop('checked', false);
          $('#ukdate2').parent().removeClass('active');
        } 
        else {
          $('#ukdate1').prop('checked', false);
          $('#ukdate1').parent().removeClass('active');
          
          $('#ukdate2').prop('checked', true);
          $('#ukdate2').parent().addClass('active'); 
        }


        if(mBranding) {
          $('#branding1').prop('checked', true);
          $('#branding1').parent().addClass('active');
          
          $('#branding2').prop('checked', false);
          $('#branding2').parent().removeClass('active');
        } 
        else {
          $('#branding1').prop('checked', false);
          $('#branding1').parent().removeClass('active');
          
          $('#branding2').prop('checked', true);
          $('#branding2').parent().addClass('active'); 
        }	
		
      });

      $("#configure-form").submit(function(e) {  

	mHollowfont = $('#hollowfont1').prop('checked') ? 1 : 0;
        mInvert = $('#invert1').prop('checked') ? 1 : 0;
	mUkdate = $('#ukdate1').prop('checked') ? 1 : 0;
        mBranding = $('#branding1').prop('checked') ? 1 : 0;

	localStorage.setItem("hollowfont", mHollowfont); 
        localStorage.setItem("invert", mInvert); 
	localStorage.setItem("ukdate", mUkdate); 
        localStorage.setItem("branding", mBranding); 
        
        var j = {
	  hollowfont : parseInt(mHollowfont),
          invert : parseInt(mInvert),
	  ukdate : parseInt(mUkdate),
          branding: parseInt(mBranding)
        };
        
        var return_to = getQueryParam('return_to', 'pebblejs://close#');
        document.location = return_to + JSON.stringify(j);

        //window.location.href = "pebblejs://close#" + JSON.stringify(j);

        e.preventDefault();
      });
  </script>
</body>
</html>
